<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prachi's Smile Quiz</title>
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* Color Palette */
    :root {
      --primary: #F8BBD0;  /* muted blush pink */
      --neutral: #FFF8E1;  /* soft cream */
      --contrast: #FFFFFF; /* crisp white */
      --accent: #D4AF37;   /* subtle gold */
      --secondary-text: #888888; /* soft gray */
    }
    /* Global Styles */
    body {
      margin: 0;
      padding: 0;
      background-color: var(--neutral);
      font-family: 'Lato', sans-serif;
      color: var(--secondary-text);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow-x: hidden;
    }
    /* Container styling */
    #game-container {
      width: 90%;
      max-width: 600px;
      background-color: var(--contrast);
      border: 1px solid var(--primary);
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      padding: 20px;
      box-sizing: border-box;
      text-align: center;
      position: relative;
      opacity: 1;
      transition: opacity 0.8s ease;
    }
    .fade-out {
      opacity: 0;
    }
    h1, h2, h3 {
      font-family: 'Playfair Display', serif;
      color: var(--primary);
      letter-spacing: 1px;
      margin-bottom: 15px;
    }
    p {
      font-size: 1em;
      line-height: 1.5;
    }
    /* Progress Indicator */
    #progress {
      font-size: 0.9em;
      margin-bottom: 10px;
      color: var(--secondary-text);
    }
    /* Button styling */
    button {
      background-color: var(--primary);
      color: var(--contrast);
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      font-family: 'Playfair Display', serif;
    }
    button:hover {
      transform: scale(1.05);
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    /* Photo styling */
    .photo {
      width: 100%;
      max-width: 300px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      transition: transform 0.3s ease;
    }
    /* Items container */
    .items-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
      justify-items: center;
    }
    .item {
      width: 100px;
      height: 100px;
      border: 2px solid var(--primary);
      border-radius: 8px;
      background-color: var(--neutral);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: grab;
      transition: transform 0.2s ease;
      position: relative;
    }
    .item:hover::after {
      content: attr(data-label);
      position: absolute;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--primary);
      color: var(--contrast);
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.8em;
      white-space: nowrap;
    }
    .item img {
      width: 80%;
      border-radius: 4px;
    }
    /* Drop zone styling */
    #drop-zone {
      width: 300px;
      height: 300px;
      margin: 20px auto;
      border: 3px dashed var(--primary);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--neutral);
      position: relative;
    }
    /* Modal Popup for Wrong Answer */
    #popup-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }
    #popup-content {
      background-color: var(--contrast);
      border: 2px solid var(--primary);
      border-radius: 12px;
      padding: 20px;
      max-width: 400px;
      text-align: center;
    }
    #popup-content img {
      width: 100%;
      max-width: 300px;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    /* Confetti canvas */
    #confetti-canvas {
      position: fixed;
      pointer-events: none;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 9999;
    }
    /* Responsive tweaks */
    @media (max-width: 600px) {
      #drop-zone {
        width: 90%;
        height: auto;
        padding: 10px;
      }
      .items-container {
        grid-template-columns: 1fr 1fr;
      }
    }
  </style>
</head>
<body>
  <canvas id="confetti-canvas"></canvas>
  <div id="game-container"></div>
  
  <!-- Popup Modal -->
  <div id="popup-modal">
    <div id="popup-content">
      <img src="https://via.placeholder.com/300x200?text=Annoyed+Prachi" alt="Annoyed Prachi">
      <h3>You did it wrong, bitch! Get her the right stuff, try again!</h3>
      <button id="popup-btn">Continue</button>
    </div>
  </div>
  
  <!-- Audio placeholders: Replace the src URLs with your own sound files -->
  <audio id="audio-correct" src="your-correct-sound.mp3"></audio>
  <audio id="audio-wrong" src="your-wrong-sound.mp3"></audio>
  <!-- Final sound loops -->
  <audio id="audio-final" src="your-final-sound.mp3" loop></audio>

  <script>
    // Quiz Data
    const quizData = [
      {
        type: 'start',
        header: 'Welcome to Prachi\'s Smile Quiz',
        message: 'Hit "Start Game" to begin!',
        buttonText: 'Start Game'
      },
      {
        type: 'intro',
        photo: 'https://via.placeholder.com/300x200?text=This+is+Prachi',
        message: 'There\'s a problem... she isn’t smiling much. Let\'s fix that with a fun quiz!',
        buttonText: 'Start Quiz'
      },
      {
        type: 'quiz',
        header: 'She is really sad right now',
        photo: 'https://via.placeholder.com/300x200?text=Sad+Prachi',
        progress: 'Step 1 of 5',
        enlargeOnDrop: true,
        items: [
          { id: 'item1', label: 'Water', img: 'https://via.placeholder.com/100?text=Water', correct: false },
          { id: 'item2', label: 'Rookie Coffee', img: 'https://via.placeholder.com/100?text=Rookie+Coffee', correct: true }
        ]
      },
      {
        type: 'quiz',
        header: 'She is really sad right now',
        photo: 'https://via.placeholder.com/300x200?text=Sad+Prachi',
        progress: 'Step 2 of 5',
        enlargeOnDrop: true,
        items: [
          { id: 'item3', label: 'Waffles', img: 'https://via.placeholder.com/100?text=Waffles', correct: true },
          { id: 'item4', label: 'Donuts', img: 'https://via.placeholder.com/100?text=Donuts', correct: false }
        ]
      },
      {
        type: 'quiz',
        header: 'A freaky mood!',
        photo: 'https://via.placeholder.com/300x200?text=Sad+Prachi',
        progress: 'Step 3 of 5',
        enlargeOnDrop: true,
        items: [
          { id: 'item5', label: 'Unicorn Tears', img: 'https://via.placeholder.com/100?text=Unicorn+Tears', correct: false },
          { id: 'item6', label: 'Glitter Bomb', img: 'https://via.placeholder.com/100?text=Glitter+Bomb', correct: true }
        ]
      },
      {
        // Cocaine quiz: even though it's wrong, we still move forward.
        type: 'quiz',
        header: 'Maybe cocaine?',
        photo: 'https://via.placeholder.com/300x200?text=Prachi+??',
        progress: 'Step 4 of 5',
        enlargeOnDrop: false,
        items: [
          { id: 'item7', label: 'Cocaine', img: 'https://via.placeholder.com/100?text=Cocaine', correct: false }
        ]
      },
      {
        // Big smile quiz
        type: 'quiz',
        header: 'I don’t think Prachi needs any of this materialism, the only thing she needs is a big smile!',
        photo: 'https://via.placeholder.com/300x200?text=Prachi+Neutral',
        progress: 'Step 5 of 5',
        enlargeOnDrop: true,
        items: [
          { id: 'item8', label: 'Smile', img: 'https://via.placeholder.com/100?text=Smile', correct: true }
        ]
      },
      {
        // Smiling Prachi screen: after correct smile answer
        type: 'smile',
        photo: 'https://via.placeholder.com/300x200?text=Prachi+Smiling',
        buttonText: 'One Final Message'
      },
      {
        // Final: Slideshow with dogs and cats and looping final sound
        type: 'final',
        message: 'No materialism, just a big smile :)',
        slideshowPhotos: [
          'dogrose.jpeg',
          'dog.jpeg',
          'cat.jpeg',
          'cat1.jpeg'
        ]
      }
    ];

    let currentStep = 0;
    const gameContainer = document.getElementById('game-container');
    const popupModal = document.getElementById('popup-modal');
    const popupBtn = document.getElementById('popup-btn');
    const transitionDelay = 2500; // 2.5 seconds

    // Utility: fade out then callback to render new content
    function transitionToNext(callback) {
      gameContainer.classList.add('fade-out');
      setTimeout(() => {
        callback();
        gameContainer.classList.remove('fade-out');
      }, 800); // 0.8s fade out
    }

    // Confetti effect (basic)
    function showConfetti() {
      const canvas = document.getElementById('confetti-canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      const particles = [];
      for (let i = 0; i < 100; i++) {
        particles.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height - canvas.height,
          r: Math.random() * 4 + 1,
          d: Math.random() * 100,
          color: 'rgba(' + Math.floor(Math.random()*255) + ',' + 
                 Math.floor(Math.random()*255) + ',' + 
                 Math.floor(Math.random()*255) + ',1)'
        });
      }
      let angle = 0;
      const confettiInterval = setInterval(() => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        angle += 0.01;
        particles.forEach(p => {
          p.y += Math.cos(angle + p.d) + 1;
          p.x += Math.sin(angle) * 2;
          ctx.fillStyle = p.color;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
          ctx.fill();
        });
      }, 20);
      setTimeout(() => {
        clearInterval(confettiInterval);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }, 3000);
    }

    // Render current step
    function renderStep() {
      gameContainer.innerHTML = '';
      const step = quizData[currentStep];

      // Display progress if applicable
      if (step.progress) {
        const progressEl = document.createElement('div');
        progressEl.id = 'progress';
        progressEl.textContent = step.progress;
        gameContainer.appendChild(progressEl);
      }

      if (step.type === 'start') {
        const header = document.createElement('h1');
        header.textContent = step.header;
        gameContainer.appendChild(header);
        const message = document.createElement('p');
        message.textContent = step.message;
        gameContainer.appendChild(message);
        const btn = document.createElement('button');
        btn.textContent = step.buttonText;
        btn.addEventListener('click', () => {
          transitionToNext(() => { currentStep++; renderStep(); });
        });
        gameContainer.appendChild(btn);
      } else if (step.type === 'intro') {
        const img = document.createElement('img');
        img.src = step.photo;
        img.className = 'photo';
        gameContainer.appendChild(img);
        const msg = document.createElement('p');
        msg.textContent = step.message;
        gameContainer.appendChild(msg);
        const btn = document.createElement('button');
        btn.textContent = step.buttonText;
        btn.addEventListener('click', () => {
          transitionToNext(() => { currentStep++; renderStep(); });
        });
        gameContainer.appendChild(btn);
      } else if (step.type === 'quiz') {
        const header = document.createElement('h2');
        header.textContent = step.header;
        gameContainer.appendChild(header);
        const dropZone = document.createElement('div');
        dropZone.id = 'drop-zone';
        dropZone.addEventListener('dragover', (e) => e.preventDefault());
        dropZone.addEventListener('drop', (e) => {
          e.preventDefault();
          const itemId = e.dataTransfer.getData('text/plain');
          handleDrop(itemId, dropZone, step);
        });
        const img = document.createElement('img');
        img.src = step.photo;
        img.className = 'photo';
        dropZone.appendChild(img);
        gameContainer.appendChild(dropZone);
        // Items container
        const itemsContainer = document.createElement('div');
        itemsContainer.className = 'items-container';
        step.items.forEach(item => {
          const itemDiv = document.createElement('div');
          itemDiv.className = 'item';
          itemDiv.draggable = true;
          itemDiv.id = item.id;
          itemDiv.dataset.correct = item.correct;
          itemDiv.setAttribute('data-label', item.label);
          itemDiv.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', item.id);
          });
          const itemImg = document.createElement('img');
          itemImg.src = item.img;
          itemImg.alt = item.label;
          itemDiv.appendChild(itemImg);
          itemsContainer.appendChild(itemDiv);
        });
        gameContainer.appendChild(itemsContainer);
      } else if (step.type === 'smile') {
        const img = document.createElement('img');
        img.src = step.photo;
        img.className = 'photo';
        gameContainer.appendChild(img);
        const btn = document.createElement('button');
        btn.textContent = step.buttonText;
        btn.addEventListener('click', () => {
          transitionToNext(() => { currentStep++; renderStep(); });
        });
        gameContainer.appendChild(btn);
      } else if (step.type === 'final') {
        const msg = document.createElement('h2');
        msg.textContent = step.message;
        gameContainer.appendChild(msg);
        const slideshow = document.createElement('div');
        slideshow.id = 'slideshow';
        gameContainer.appendChild(slideshow);
        let idx = 0;
        function updateSlide() {
          slideshow.innerHTML = '';
          const img = document.createElement('img');
          img.src = step.slideshowPhotos[idx];
          img.className = 'photo';
          slideshow.appendChild(img);
          idx = (idx + 1) % step.slideshowPhotos.length;
        }
        updateSlide();
        setInterval(updateSlide, 2000);
        document.getElementById('audio-final').play();
        showConfetti();
      }
    }

    // Handle drop event
    function handleDrop(itemId, dropZone, step) {
      const itemEl = document.getElementById(itemId);
      const isCorrect = itemEl.dataset.correct === 'true';
      if (isCorrect) {
        document.getElementById('audio-correct').play();
        if (step.enlargeOnDrop) {
          const img = dropZone.querySelector('img');
          img.style.transform = 'scale(1.2)';
          setTimeout(() => img.style.transform = 'scale(1)', 300);
        }
        // Add confetti for extra flair
        showConfetti();
        // Delay transition to allow sound to finish (2.5s)
        setTimeout(() => {
          transitionToNext(() => {
            currentStep++;
            renderStep();
          });
        }, transitionDelay);
      } else {
        document.getElementById('audio-wrong').play();
        popupModal.style.display = 'flex';
      }
    }

    // Popup Continue Button
    popupBtn.addEventListener('click', () => {
      popupModal.style.display = 'none';
      // If current step is the cocaine quiz, move forward regardless.
      if (quizData[currentStep].header.toLowerCase().includes("cocaine")) {
        transitionToNext(() => { currentStep++; renderStep(); });
      } else {
        // For other wrong answers, simply re-render same step.
        transitionToNext(() => { renderStep(); });
      }
    });

    // Initial render
    renderStep();
  </script>
</body>
</html>
